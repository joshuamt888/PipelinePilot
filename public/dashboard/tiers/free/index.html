<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 SteadyManager - Dashboard</title>
    
    <!-- CDN Resources -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* 🎨 CLEAN DESIGN SYSTEM */
        :root {
            --primary: #667eea;
            --primary-dark: #4f46e5;
            --primary-light: #dbeafe;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --border: #e2e8f0;
            
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            
            --radius: 8px;
            --radius-lg: 16px;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 🌙 DARK MODE BASE */
        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --surface-hover: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border: #334155;
        }

        /* 🌙 DARK MODE ENHANCEMENT ATTACHMENT */
        [data-theme="dark"] {
            /* Core Colors - Deeper, richer palette */
            --background: #0a0f1c;
            --surface: #1a1f2e;
            --surface-hover: #242938;
            --surface-elevated: #2d3142;
            
            /* Text with better contrast ratios */
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            
            /* Enhanced borders and dividers */
            --border: #374151;
            --border-light: #4b5563;
            --border-accent: #6366f1;
            
            /* Improved accent colors for dark mode */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            
            /* Status colors optimized for dark backgrounds */
            --success: #10b981;
            --success-dark: #059669;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --info: #06b6d4;
            --info-dark: #0891b2;
            
            /* Enhanced gradients for dark mode */
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            --gradient-surface: linear-gradient(135deg, #1a1f2e 0%, #242938 100%);
            --gradient-card: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            
            /* Dark mode specific shadows */
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            
            /* Glow effects for dark mode */
            --glow-primary: 0 0 20px rgba(99, 102, 241, 0.3);
            --glow-success: 0 0 20px rgba(16, 185, 129, 0.3);
            --glow-warning: 0 0 20px rgba(245, 158, 11, 0.3);
            --glow-danger: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        /* 🌙 Dark Mode Sidebar Enhancements */
        [data-theme="dark"] .sidebar {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 30%, #1e293b 70%, #0f172a 100%);
            border-right: 1px solid var(--border);
            box-shadow: var(--shadow-xl), inset 0 1px 0 rgba(148, 163, 184, 0.1);
        }

        [data-theme="dark"] .sidebar-logo {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 2px 8px rgba(99, 102, 241, 0.3));
        }

        [data-theme="dark"] .nav-link {
            color: rgba(241, 245, 249, 0.7);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.6s ease;
        }

        [data-theme="dark"] .nav-link:hover {
            color: #f1f5f9;
            background: rgba(99, 102, 241, 0.1);
            border-left: 2px solid var(--primary);
            box-shadow: inset 0 0 20px rgba(99, 102, 241, 0.1);
        }

        [data-theme="dark"] .nav-link:hover::before {
            left: 100%;
        }

        [data-theme="dark"] .nav-link.active {
            color: #f1f5f9;
            background: rgba(99, 102, 241, 0.2);
            border-left: 3px solid var(--primary);
            box-shadow: var(--glow-primary), inset 0 0 20px rgba(99, 102, 241, 0.1);
        }

        [data-theme="dark"] .upgrade-nav-link {
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            backdrop-filter: blur(10px);
        }

        [data-theme="dark"] .upgrade-nav-link:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            box-shadow: var(--glow-primary);
            transform: translateY(-2px);
        }

        /* 🌙 Dark Mode Header & Content */
        [data-theme="dark"] .header {
            background: rgba(26, 31, 46, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .header-title {
            color: white !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            -webkit-text-fill-color: unset !important;
            background-clip: unset !important;
            filter: none !important;
        }

        /* 🌙 Dark Mode User Menu */
        [data-theme="dark"] .user-menu {
            background: var(--surface);
            border: 1px solid var(--border);
            box-shadow: var(--shadow), 0 0 0 1px rgba(99, 102, 241, 0.05);
        }

        [data-theme="dark"] .user-menu:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg), var(--glow-primary);
            transform: translateY(-1px);
        }

        [data-theme="dark"] .user-menu::before {
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
        }

        [data-theme="dark"] .profile-dropdown {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-2xl), 0 0 0 1px rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(20px);
        }

        [data-theme="dark"] .dropdown-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-light);
        }

        /* 🌙 Dark Mode Scrollbars */
        [data-theme="dark"] ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: var(--surface);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
            box-shadow: 0 0 8px rgba(99, 102, 241, 0.3);
        }

        /* 🎯 SICK LEAD PROGRESS BAR IN HEADER */
        .lead-progress-header {
            display: flex;
            align-items: center;
            background: var(--surface-hover);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 0.75rem 1rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .lead-progress-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.8s ease;
        }

        .lead-progress-header:hover {
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .lead-progress-header:hover::before {
            left: 100%;
        }

        .progress-content {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 120px;
        }

        .progress-stats {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .current-leads {
            color: var(--primary);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.1rem;
            text-align: center;
        }

        .progress-separator {
    color: var(--text-tertiary);
    font-size: 1.1rem;   /* Same size */
    font-weight: 500;
    margin: 0 2px;       /* Better spacing */
}

        .max-leads {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .leads-label {
            color: var(--text-tertiary);
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 0.25rem;
        }

        .progress-bar-mini {
            width: 100%;
            height: 4px;
            background: var(--surface);
            border-radius: 2px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .progress-fill-mini {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 2px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress-fill-mini.near-limit {
            background: linear-gradient(135deg, var(--warning) 0%, #f97316 100%);
        }

        .progress-fill-mini.at-limit {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }

        /* 🌙 Dark Mode Progress Bar */
        [data-theme="dark"] .lead-progress-header {
            background: var(--surface);
            border-color: var(--border);
        }

        [data-theme="dark"] .current-leads {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        [data-theme="dark"] .progress-bar-mini {
            background: var(--background);
        }

        /* 📱 Mobile Progress Bar */
        @media (max-width: 768px) {
            .lead-progress-header {
                padding: 0.5rem 0.75rem;
                min-width: 100px;
            }

            .progress-stats {
                font-size: 1rem;
            }

            .current-leads {
    width: 28px; /* Fixed width instead of min-width */
    text-align: center;
}

            .leads-label {
                display: none;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* 🗂️ SIDEBAR - SIMPLIFIED & SLEEK */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--gradient-primary);
            color: white;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .sidebar-content {
            padding: 2rem 0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .sidebar-logo {
            font-size: 1.75rem;
            font-weight: 900;
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 🧭 NAVIGATION - CLEAN & SIMPLE */
        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin-bottom: auto;
            flex: 1;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            font-weight: 500;
            cursor: pointer;
            margin: 0 0.75rem;
            border-radius: var(--radius);
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(8px);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            transform: translateX(8px);
        }

        .nav-emoji {
            font-size: 1.2rem;
        }

        .pro-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            font-size: 0.6rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 9999px;
            margin-left: auto;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .nav-link.disabled {
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
        }

        /* 🚀 UPGRADE BUTTON - SIMPLIFIED */
        .upgrade-nav-item {
            margin: 1.5rem 0.75rem 1rem;
        }

        .upgrade-nav-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 0.95rem;
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }

        .upgrade-nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.2);
        }

        .upgrade-emoji {
            font-size: 1.2rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* 📊 MAIN CONTENT */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            background: var(--background);
            transition: var(--transition);
        }

        /* 📋 HEADER - LOCKED & CONSISTENT */
        .header {
            background: var(--surface);
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            transition: var(--transition);
            border-bottom: 1px solid var(--border);
            height: 80px; /* FIXED HEIGHT - NO CHANGES ALLOWED */
            min-height: 80px;
            max-height: 80px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: var(--transition);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* 👤 USER MENU - CLEAN & FUNCTIONAL */
        .user-menu-container {
            position: relative;
            z-index: 200;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--surface-hover);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .user-menu:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: var(--shadow);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .user-tier {
            font-size: 0.75rem;
            color: var(--success);
            font-weight: 500;
        }

        .chevron-down {
            width: 16px;
            height: 16px;
            opacity: 0.5;
            transition: var(--transition);
        }

        .user-menu:hover .chevron-down {
            opacity: 1;
            transform: rotate(180deg);
        }

        /* 📋 PROFILE DROPDOWN - CLEAN */
        .profile-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 220px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .profile-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .dropdown-item:hover {
            background: var(--surface-hover);
            color: var(--primary);
        }

        .logout-item {
            color: var(--danger);
            border-top: 1px solid var(--border);
        }

        .logout-item:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .dropdown-icon {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        .dropdown-toggle {
            margin-left: auto;
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: var(--border);
            border-radius: 9999px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: var(--surface);
            border-radius: 50%;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .toggle-switch {
            background: var(--primary);
        }

        [data-theme="dark"] .toggle-slider {
            transform: translateX(20px);
        }

        /* 📱 CONTENT AREA - LOCKED HEIGHT */
        .dashboard-content {
            padding: 2rem;
            min-height: calc(100vh - 80px); /* FIXED: Based on locked header height */
            transition: var(--transition);
        }

        .content-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 📱 MOBILE RESPONSIVE */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                padding: 1rem;
            }

            .dashboard-content {
                padding: 1rem;
            }

            /* 🚫 NEVER HIDE USER INFO - ALWAYS VISIBLE */
            .user-info {
                display: flex !important; /* FORCE SHOW */
            }
            
            /* Make user menu smaller on mobile but always visible */
            .user-menu {
                padding: 0.25rem 0.5rem;
            }
            
            .user-name {
                font-size: 0.75rem;
            }
            
            .user-tier {
                font-size: 0.65rem;
            }
        }

        /* 🎪 ANIMATIONS */
        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 🔄 LOADING STATE */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 🌟 STEADYUTILS ENHANCEMENTS */
        .sidebar-nav .nav-link {
            position: relative;
            /* Removed overflow: hidden and shimmer effect */
        }

        .user-menu {
            position: relative;
            /* Removed overflow: hidden and shimmer effect */
        }

        /* 🎨 THEME TRANSITION ENHANCEMENTS */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        /* 🌈 GRADIENT HOVER EFFECTS */
        .upgrade-nav-link {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            position: relative;
            overflow: hidden;
        }

        .upgrade-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .upgrade-nav-link:hover::before {
            left: 100%;
        }
    </style>
</head>
<body data-theme="light">
    <!-- 🗂️ SIDEBAR -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    SteadyManager
                </div>
            </div>

            <nav>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard">
                            <span class="nav-emoji">📊</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="leads">
                            <span class="nav-emoji">👥</span>
                            <span>Add Leads</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="pipeline">
                            <span class="nav-emoji">🌿</span>
                            <span>Pipeline</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="scheduling">
                            <span class="nav-emoji">📅</span>
                            <span>Scheduling</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link disabled" data-page="upgrade" data-upgrade-trigger="analytics">
                            <span class="nav-emoji">📈</span>
                            <span>Analytics</span>
                            <span class="pro-badge">PRO</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="settings">
                            <span class="nav-emoji">⚙️</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- 🚀 UPGRADE NAVIGATION BUTTON -->
            <div class="upgrade-nav-item">
                <a href="#" class="upgrade-nav-link" data-page="upgrade">
                    <span class="upgrade-emoji">🚀</span>
                    <span>Upgrade Plan</span>
                </a>
            </div>
        </div>
    </div>

    <!-- 📊 MAIN CONTENT -->
    <div class="main-content">
        <!-- 📋 HEADER - LOCKED DOWN & CONSISTENT -->
        <header class="header">
            <div class="header-left">
                <h1 class="header-title" id="pageTitle">Dashboard</h1>
            </div>
            
            <div class="header-right">
                <!-- 🎯 LEAD PROGRESS BAR -->
                <div class="lead-progress-header" id="leadProgressHeader">
                    <div class="progress-content">
                        <div class="progress-stats">
                            <span class="current-leads" id="currentLeads">-</span>
                            <span class="progress-separator">/</span>
                            <span class="max-leads">50</span>
                            <span class="leads-label">leads</span>
                        </div>
                        <div class="progress-bar-mini">
                            <div class="progress-fill-mini" id="progressFillMini" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- 👤 USER MENU - ALWAYS VISIBLE -->
                <div class="user-menu-container">
                    <div class="user-menu" id="userMenu">
                        <div class="user-avatar" id="userAvatar">
                            <div class="loading-spinner"></div>
                        </div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Loading...</div>
                            <div class="user-tier" id="userTier">Free Plan</div>
                        </div>
                        <i data-lucide="chevron-down" class="chevron-down"></i>
                    </div>
                    
                    <!-- 📋 PROFILE DROPDOWN -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-item" id="darkModeToggle">
                            <i data-lucide="moon" class="dropdown-icon"></i>
                            <span>Dark Mode</span>
                            <div class="dropdown-toggle">
                                <div class="toggle-switch">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                        <div class="dropdown-item" data-page="settings">
                            <i data-lucide="settings" class="dropdown-icon"></i>
                            <span>Settings</span>
                        </div>
                        <div class="dropdown-item logout-item" id="logoutBtn">
                            <i data-lucide="log-out" class="dropdown-icon"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 📊 CONTENT AREA -->
        <main class="dashboard-content">
            <div class="content-container" id="mainContent">
                <!-- Module content loads here -->
                <div class="fade-in" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">🚀</div>
                    <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                        SteadyManager Ready
                    </h2>
                    <p>Select a page from the sidebar to get started!</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 🚀 SIMPLE & CLEAN NAVIGATION SYSTEM -->
    <script>
        // 🎬 INITIALIZE
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Simple SteadyManager Shell loading...');
            
            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Apply saved theme
            applySavedTheme();
            
            // Setup navigation
            setupNavigation();
            
            // Setup user menu
            setupUserMenu();
            
            // Initialize shell with real data
            initializeShell();
            
            console.log('✅ Simple Shell ready!');
        });

        // 🔐 SIMPLE SHELL INITIALIZATION
        async function initializeShell() {
            try {
                console.log('🔐 Initializing simple shell...');
                
                // Check authentication
                const authResponse = await API.checkAuth();
                
                if (!authResponse.authenticated) {
                    console.log('❌ Not authenticated, redirecting to login');
                    window.location.href = '/login?error=auth_required';
                    return;
                }
                
                console.log('✅ Authentication verified');
                
                // Load user profile
                await loadUserProfile();
                
                // 🎯 Load lead progress
                await loadLeadProgress();
                
                console.log('✅ Simple shell initialized successfully');
                
            } catch (error) {
                console.error('❌ Shell initialization failed:', error);
                showInitializationError(error.message);
            }
        }

        // 🎯 LOAD LEAD PROGRESS BAR
        async function loadLeadProgress() {
            try {
                console.log('🎯 Loading lead progress...');
                const stats = await API.getCurrentMonthStats();
                
                const currentCount = stats.currentMonthLeads || 0;
                const maxCount = 50; // Fixed limit
                const percentage = Math.min((currentCount / maxCount) * 100, 100);
                
                // Update the display
                document.getElementById('currentLeads').textContent = currentCount;
                
                const progressFill = document.getElementById('progressFillMini');
                progressFill.style.width = `${percentage}%`;
                
                // Update styling based on progress
                progressFill.className = 'progress-fill-mini';
                if (percentage >= 100) {
                    progressFill.classList.add('at-limit');
                } else if (percentage >= 80) {
                    progressFill.classList.add('near-limit');
                }
                
                console.log(`🎯 Lead progress loaded: ${currentCount}/50 (${Math.round(percentage)}%)`);
                
                // Make progress bar clickable to go to pipeline
                const progressHeader = document.getElementById('leadProgressHeader');
                progressHeader.addEventListener('click', () => {
                    loadPage('pipeline');
                });
                
            } catch (error) {
                console.error('❌ Failed to load lead progress:', error);
                // Set fallback values
                document.getElementById('currentLeads').textContent = '-';
            }
        }

        // 👤 LOAD USER PROFILE
        async function loadUserProfile() {
            try {
                const authResponse = await API.checkAuth();
                if (authResponse.authenticated && authResponse.user) {
                    const user = authResponse.user;
                    
                    // Generate user initials from email
                    const email = user.email || 'User';
                    const initials = generateInitials(email);
                    
                    // Use full email as display name
                    const displayName = email;
                    
                    // Map subscription tiers to display names
                    const tierDisplayNames = {
                        'FREE': 'Free Plan',
                        'PROFESSIONAL': 'Professional',
                        'PROFESSIONAL_TRIAL': 'Trial',
                        'BUSINESS': 'Business',
                        'ENTERPRISE': 'Enterprise',
                        'ADMIN': 'Admin'
                    };
                    
                    const tierDisplay = tierDisplayNames[user.subscriptionTier] || 'Free Plan';
                    
                    // Update UI with smooth animations
                    updateUserInfo({
                        name: displayName,
                        initials: initials,
                        tier: tierDisplay
                    });
                    
                    console.log(`👤 User loaded: ${displayName} (${tierDisplay})`);
                } else {
                    console.error('❌ Auth check failed in loadUserProfile');
                }
                
            } catch (error) {
                console.error('❌ Failed to load user profile:', error);
                // Set fallback values
                updateUserInfo({
                    name: 'User',
                    initials: 'U',
                    tier: 'Free Plan'
                });
            }
        }

        // 🔤 GENERATE INITIALS FROM EMAIL
        function generateInitials(email) {
            if (!email) return 'U';
            
            const namePart = email.split('@')[0];
            const parts = namePart.split(/[._-]/);
            
            if (parts.length >= 2) {
                return (parts[0][0] + parts[1][0]).toUpperCase();
            } else {
                return namePart.substring(0, 2).toUpperCase();
            }
        }

        // ❌ SHOW INITIALIZATION ERROR
        function showInitializationError(errorMessage) {
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.innerHTML = `
                    <div class="fade-in" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
                        <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                            Connection Error
                        </h2>
                        <p>Unable to load dashboard data. Please check your connection and try refreshing.</p>
                        <button onclick="location.reload()" style="
                            margin-top: 1rem; 
                            padding: 0.75rem 1.5rem; 
                            background: var(--primary); 
                            color: white; 
                            border: none; 
                            border-radius: var(--radius); 
                            cursor: pointer;
                            font-weight: 600;
                            transition: var(--transition);
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            🔄 Retry
                        </button>
                    </div>
                `;
            }
        }

        // 🎨 THEME MANAGEMENT
        function applySavedTheme() {
            const savedTheme = window.SteadyUtils ? 
                SteadyUtils.storage.get('dashboard-theme', 'light') : 
                localStorage.getItem('dashboard-theme') || 'light';
                
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        function toggleTheme() {
            if (window.SteadyUtils && SteadyUtils.theme) {
                const newTheme = SteadyUtils.theme.toggle();
                
                // Show theme change toast
                SteadyUtils.showToast(`Switched to ${newTheme} mode! 🎨`, 'success', {
                    duration: 2000,
                    position: 'bottom-right'
                });
                
                return;
            }
            
            // Fallback method
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            
            try {
                localStorage.setItem('dashboard-theme', newTheme);
            } catch (error) {
                console.warn('Failed to save theme:', error);
            }
        }

        // 🧭 NAVIGATION SYSTEM
        function setupNavigation() {
            document.querySelectorAll('.nav-link, .upgrade-nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    const upgradeTrigger = link.getAttribute('data-upgrade-trigger');
                    
                    // SteadyUtils click animation
                    if (window.SteadyUtils) {
                        SteadyUtils.pulse(link, { scale: 0.95, duration: 200 });
                    }
                    
                    if (page) {
                        if (link.classList.contains('disabled') && page === 'upgrade') {
                            loadPage('upgrade', upgradeTrigger || 'navigation');
                        } else if (link.classList.contains('upgrade-nav-link')) {
                            loadPage('upgrade');
                        } else {
                            loadPage(page);
                        }
                    }
                });
            });
        }

        async function loadPage(pageName, triggerSource = null) {
    // 🔥 CANCEL ANY PENDING OPERATIONS
    if (window.currentPageLoad) {
        window.currentPageLoad.cancelled = true;
    }
    
    // 🔥 CREATE NEW LOAD TRACKER
    const currentLoad = { cancelled: false, pageName };
    window.currentPageLoad = currentLoad;
    
    console.log(`🧭 Loading page: ${pageName}`);
    
    // 🔥 CHECK IF CANCELLED BEFORE EACH ASYNC OPERATION
    const checkCancelled = () => {
        if (currentLoad.cancelled) {
            console.log(`🚫 ${pageName} load cancelled`);
            return true;
        }
        return false;
    };
    
    // 🔥 FIRST: Clear any existing modals from previous modules
    document.querySelectorAll('.addlead-modal-overlay, .edit-modal-streamlined, .pipeline-selector-modal, .upgrade-modal-overlay').forEach(modal => {
        modal.remove();
    });
    
    // Update active nav state with animations
    document.querySelectorAll('.nav-link, .upgrade-nav-link').forEach(link => {
        link.classList.remove('active');
    });
    
    if (pageName === 'upgrade') {
        document.querySelector('.upgrade-nav-link')?.classList.add('active');
    } else {
        document.querySelector(`[data-page="${pageName}"]`)?.classList.add('active');
    }
    
    // Page titles
    const pageTitles = {
        dashboard: 'Dashboard',
        leads: 'Add Leads', 
        pipeline: 'Pipeline',
        scheduling: 'Scheduling',
        analytics: 'Analytics',
        settings: 'Settings',
        upgrade: 'Upgrade Plan'
    };
    
    // Update page title
    const pageTitle = document.getElementById('pageTitle');
    if (pageTitle) {
        const newTitle = pageTitles[pageName] || pageName.charAt(0).toUpperCase() + pageName.slice(1);
        pageTitle.textContent = newTitle;
    }
    
    // 🔥 CLEAR MAIN CONTENT FIRST - HARD RESET
    const mainContent = document.getElementById('mainContent');
    if (mainContent) {
        mainContent.innerHTML = `
            <div class="fade-in" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
                <div style="font-size: 2rem; margin-bottom: 1rem;">⏳</div>
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                    Loading ${pageTitles[pageName]}...
                </h2>
            </div>
        `;
    }
    
    // 🔥 STANDARD MODULE LOADING (Dashboard, Pipeline, etc.)
    const moduleNames = {
        dashboard: 'DashboardController',
        leads: 'AddLeadModule',
        pipeline: 'PipelineModule',
        scheduling: 'SchedulingModule',
        settings: 'SettingsModule',
        upgrade: 'UpgradeModule'
    };
    
    const moduleName = moduleNames[pageName];
    if (checkCancelled()) return;
    const module = window[moduleName];
    
    if (module && typeof module.init === 'function') {
        console.log(`✅ Loading ${moduleName}...`);
        
        // Pass trigger source to upgrade module for context
        if (pageName === 'upgrade' && triggerSource) {
            module.init({ triggerSource });
        } else {
            module.init();
        }
    } else {
        console.warn(`⚠️ Module ${moduleName} not found`);
        showModuleNotFound(pageName);
    }
}

        function showModuleNotFound(pageName) {
    const mainContent = document.getElementById('mainContent');
    if (mainContent) {
        const emoji = {
            dashboard: '📊',
            leads: '👥', 
            pipeline: '🌿',
            scheduling: '📅',
            analytics: '📈',
            settings: '⚙️',
            upgrade: '🚀'
        }[pageName] || '📦';
        if (checkCancelled()) return;
        
        mainContent.innerHTML = `
            <div class="fade-in" style="text-align: center; padding: 4rem; color: var(--text-secondary);">
                <div style="font-size: 3rem; margin-bottom: 1rem;">${emoji}</div>
                <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                    ${pageName.charAt(0).toUpperCase() + pageName.slice(1)} Module
                </h2>
                <p>Module not loaded yet. Check that the script is included.</p>
            </div>
        `;
    }
}

        // 👤 USER MENU SETUP
        function setupUserMenu() {
            const userMenu = document.getElementById('userMenu');
            const profileDropdown = document.getElementById('profileDropdown');
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            // Toggle dropdown with animation
            userMenu?.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown?.classList.toggle('show');
                
                // Pulse animation on click
                if (window.SteadyUtils) {
                    SteadyUtils.pulse(userMenu, { scale: 0.95, duration: 200 });
                }
            });
            
            // Close on outside click
            document.addEventListener('click', () => {
                profileDropdown?.classList.remove('show');
            });
            
            // Dark mode toggle
            darkModeToggle?.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleTheme();
            });
            
            // Settings from dropdown
            profileDropdown?.querySelector('[data-page="settings"]')?.addEventListener('click', () => {
                loadPage('settings');
                profileDropdown.classList.remove('show');
            });

            // Logout with confirmation
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn?.addEventListener('click', async () => {
                // Show logout confirmation if SteadyUtils available
                if (window.SteadyUtils) {
                    const modal = SteadyUtils.createModal(
                        'Confirm Logout',
                        'Are you sure you want to logout?',
                        {
                            size: 'small',
                            buttons: [
                                {
                                    text: 'Cancel',
                                    type: 'secondary',
                                    onClick: () => true // Close modal
                                },
                                {
                                    text: 'Logout',
                                    type: 'danger',
                                    onClick: async () => {
                                        await performLogout();
                                        return true; // Close modal
                                    }
                                }
                            ]
                        }
                    );
                } else {
                    // Direct logout without confirmation
                    await performLogout();
                }
                
                profileDropdown.classList.remove('show');
            });
        }

        async function performLogout() {
            try {
                if (window.SteadyUtils) {
                    SteadyUtils.showToast('Logging out... 👋', 'info', {
                        duration: 2000
                    });
                }
                
                await API.logout();
                console.log('🚪 Logged out successfully');
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login';
            }
        }

        // 🔒 LOCK DOWN HEADER - NO MODULE INTERFERENCE
        // Modules can change title but NOT the profile/user info
        
        window.loadPage = loadPage;
        
        // ✅ Allow title updates but protect user info
        window.updatePageTitle = (title) => {
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                if (window.SteadyUtils) {
                    SteadyUtils.animateOut(pageTitle, { duration: 200 }).then(() => {
                        pageTitle.textContent = title;
                        SteadyUtils.animateIn(pageTitle, { duration: 300 });
                    });
                } else {
                    pageTitle.textContent = title;
                }
            }
        };
        
        // 🔒 PROTECTED: User info updates - FORCE AVATAR STYLING
        function updateUserInfo(user) {
            const userName = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            const userTier = document.getElementById('userTier');
            
            if (user.name && userName) {
                if (window.SteadyUtils) {
                    SteadyUtils.animateOut(userName, { duration: 200 }).then(() => {
                        userName.textContent = user.name;
                        SteadyUtils.animateIn(userName, { duration: 300 });
                    });
                } else {
                    userName.textContent = user.name;
                }
            }
            
            if (user.initials && userAvatar) {
                if (window.SteadyUtils) {
                    SteadyUtils.animateOut(userAvatar, { duration: 200 }).then(() => {
                        // FORCE CLEAR ALL CONTENT AND STYLING
                        userAvatar.innerHTML = '';
                        userAvatar.textContent = user.initials;
                        
                        // FORCE PROPER STYLING
                        userAvatar.style.background = 'var(--gradient-primary)';
                        userAvatar.style.color = 'white';
                        userAvatar.style.fontSize = '0.9rem';
                        userAvatar.style.fontWeight = '700';
                        userAvatar.style.display = 'flex';
                        userAvatar.style.alignItems = 'center';
                        userAvatar.style.justifyContent = 'center';
                        
                        SteadyUtils.animateIn(userAvatar, { duration: 300 });
                    });
                } else {
                    // FORCE CLEAR ALL CONTENT AND STYLING
                    userAvatar.innerHTML = '';
                    userAvatar.textContent = user.initials;
                    
                    // FORCE PROPER STYLING
                    userAvatar.style.background = 'var(--gradient-primary)';
                    userAvatar.style.color = 'white';
                    userAvatar.style.fontSize = '0.9rem';
                    userAvatar.style.fontWeight = '700';
                    userAvatar.style.display = 'flex';
                    userAvatar.style.alignItems = 'center';
                    userAvatar.style.justifyContent = 'center';
                }
            }
            
            if (user.tier && userTier) {
                if (window.SteadyUtils) {
                    SteadyUtils.animateOut(userTier, { duration: 200 }).then(() => {
                        userTier.textContent = user.tier;
                        SteadyUtils.animateIn(userTier, { duration: 300 });
                    });
                } else {
                    userTier.textContent = user.tier;
                }
            }
        }

        // 🎯 UPDATE LEAD PROGRESS (For modules to call)
        window.updateLeadProgress = async function(newCount) {
            try {
                const maxCount = 50;
                const percentage = Math.min((newCount / maxCount) * 100, 100);
                
                // Animate the number change
                const currentLeadsEl = document.getElementById('currentLeads');
                if (currentLeadsEl) {
                    currentLeadsEl.textContent = newCount;
                }
                
                // Update progress bar
                const progressFill = document.getElementById('progressFillMini');
                if (progressFill) {
                    progressFill.style.width = `${percentage}%`;
                    
                    // Update styling
                    progressFill.className = 'progress-fill-mini';
                    if (percentage >= 100) {
                        progressFill.classList.add('at-limit');
                    } else if (percentage >= 80) {
                        progressFill.classList.add('near-limit');
                    }
                }
                
                console.log(`🎯 Progress updated: ${newCount}/50 (${Math.round(percentage)}%)`);
            } catch (error) {
                console.error('❌ Failed to update progress:', error);
            }
        };

        // 🎯 REFRESH LEAD PROGRESS (For modules to call)
        window.refreshLeadProgress = async function() {
            await loadLeadProgress();
        };

        // 🎉 WELCOME MESSAGE
        if (window.SteadyUtils) {
            setTimeout(() => {
                SteadyUtils.showToast('Welcome to SteadyManager! 🚀', 'success', {
                    duration: 3000,
                    position: 'bottom-right'
                });
            }, 1000);
        }

        console.log('🔥 Simple SteadyManager Shell ready for modules!');
        console.log('✨ Enhanced with SteadyUtils animations and interactions!');
    </script>

    <!-- 🔧 MODULE LOADER -->
    <script src="/dashboard/shared/js/utils.js"></script>
    <script src="/dashboard/shared/js/api.js"></script>
    <script src="/dashboard/tiers/free/scripts/dashboard.js"></script>
    <script src="/dashboard/tiers/free/scripts/AddLead.js"></script>
    <script src="/dashboard/tiers/free/scripts/Pipeline.js"></script>
    <script src="/dashboard/tiers/free/scripts/Scheduling.js"></script>
    <script src="/dashboard/tiers/free/scripts/Settings.js"></script>
    <script src="/dashboard/tiers/free/scripts/upgrade.js"></script>

</body>
</html>