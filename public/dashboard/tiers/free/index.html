<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        (function() {
            const savedTheme = localStorage.getItem('dashboard-theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        })();
    </script>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://*.supabase.co; font-src 'self' data:;">
    <title>SteadyManager - Dashboard</title>
    
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #4f46e5;
            --primary-light: #dbeafe;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --border: #e2e8f0;
            
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            
            --radius: 8px;
            --radius-lg: 16px;
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background: #0a0f1c;
            --surface: #1a1f2e;
            --surface-hover: #242938;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border: #374151;
            --primary: #6366f1;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        input, textarea, [contenteditable] {
            -webkit-user-select: text;
            -moz-user-select: text;
            user-select: text;
        }

        html, body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--gradient-primary);
            color: white;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .sidebar-content {
            padding: 2rem 0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 2rem;
        }

        .sidebar-logo {
            font-size: 1.75rem;
            font-weight: 900;
            text-align: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin-bottom: auto;
            flex: 1;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            cursor: pointer;
            margin: 0 0.75rem;
            border-radius: var(--radius);
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(8px);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            transform: translateX(8px);
        }

        .nav-emoji {
            font-size: 1.2rem;
        }

        .upgrade-nav-item {
            margin: 1.5rem 0.75rem 1rem;
        }

        .upgrade-nav-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 0.95rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .upgrade-nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .main-content {
            margin-left: 280px;
            height: 100vh;
            background: var(--background);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .page-content {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page-content.active {
            display: block;
            opacity: 1;
        }

        .header {
            background: var(--surface);
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            height: 80px;
            flex-shrink: 0;
            z-index: 100;
        }

        .header-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--text-primary);
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    cursor: pointer;
    padding: 0.5rem 1.5rem 0.5rem 1rem;
    border-radius: var(--radius-lg);
    transition: var(--transition);
    border: 2px solid transparent;
    position: relative;
    display: inline-block;
}

.header-title::before {
    content: '⛶';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1rem;
    opacity: 0;
    transition: all 0.3s ease;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.header-title:hover {
    border: 2px solid var(--primary);
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
    transform: scale(1.05);
    padding-right: 2.5rem;
}

.header-title:hover::before {
    opacity: 1;
}

.header-title:active {
    transform: scale(0.98);
}

        .user-menu-container {
            position: relative;
            z-index: 999999;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--surface-hover);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .user-menu:hover {
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .user-tier {
            font-size: 0.75rem;
            color: var(--success);
            font-weight: 500;
        }

        .profile-dropdown {
            position: fixed !important;
            top: 80px !important;
            right: 2rem !important;
            width: 220px !important;
            background: var(--surface) !important;
            border: 1px solid var(--border) !important;
            border-radius: var(--radius-lg) !important;
            box-shadow: var(--shadow-xl) !important;
            overflow: hidden !important;
            z-index: 2147483647 !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transform: translateY(-10px) !important;
            transition: all 0.3s ease !important;
        }

        .profile-dropdown.show {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
        }

        .dropdown-item {
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            padding: 1rem !important;
            color: var(--text-primary) !important;
            cursor: pointer !important;
            transition: var(--transition) !important;
            font-size: 0.875rem !important;
        }

        .dropdown-item:hover {
            background: var(--surface-hover) !important;
        }

        .logout-item {
            color: var(--danger) !important;
            border-top: 1px solid var(--border) !important;
        }

        .toggle-switch {
            position: relative !important;
            width: 40px !important;
            height: 20px !important;
            background: var(--border) !important;
            border-radius: 9999px !important;
            margin-left: auto !important;
        }

        .toggle-slider {
            position: absolute !important;
            top: 2px !important;
            left: 2px !important;
            width: 16px !important;
            height: 16px !important;
            background: white !important;
            border-radius: 50% !important;
            transition: var(--transition) !important;
        }

        [data-theme="dark"] .toggle-switch {
            background: var(--primary) !important;
        }

        [data-theme="dark"] .toggle-slider {
            transform: translateX(20px) !important;
        }

        .dashboard-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: var(--background);
        }

        .content-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .sidebar.desktop-hidden {
            transform: translateX(-100%);
        }
        
        .main-content.sidebar-hidden {
            margin-left: 0;
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        [data-theme="dark"] .sidebar {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 50%, #1e293b 100%);
        }
    </style>
</head>
<body data-theme="light">
    <div class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <div class="sidebar-logo">SteadyManager</div>
            </div>

            <nav>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard">
                            <span class="nav-emoji">📊</span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="leads">
                            <span class="nav-emoji">👥</span>
                            <span>Add Leads</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="pipeline">
                            <span class="nav-emoji">🌿</span>
                            <span>Pipeline</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="tasks">
                            <span class="nav-emoji">📋</span>
                            <span>Tasks</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="settings">
                            <span class="nav-emoji">⚙️</span>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="upgrade-nav-item">
                <a href="#" class="upgrade-nav-link" data-page="upgrade">
                    <span>🚀 Upgrade Plan</span>
                </a>
            </div>
        </div>
    </div>

    <div class="main-content">
        <header class="header">
            <h1 class="header-title" id="pageTitle">Dashboard</h1>
            
            <div class="user-menu-container">
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar" id="userAvatar">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-tier" id="userTier">Free Plan</div>
                    </div>
                </div>
                
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="dropdown-item" id="darkModeToggle">
                        <span>🌙 Dark Mode</span>
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="dropdown-item" data-page="settings">
                        <span>⚙️ Settings</span>
                    </div>
                    <div class="dropdown-item logout-item" id="logoutBtn">
                        <span>🚪 Logout</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="dashboard-content">
            <div class="content-container">
                <div id="dashboard-content" class="page-content active"></div>
                <div id="leads-content" class="page-content"></div>
                <div id="pipeline-content" class="page-content"></div>
                <div id="tasks-content" class="page-content"></div>
                <div id="settings-content" class="page-content"></div>
                <div id="upgrade-content" class="page-content"></div>
            </div>
        </main>
    </div>

    <script type="module">
        import { supabase } from '/dashboard/shared/js/supabase.js';
        import API from '/dashboard/shared/js/api.js';

        window.API = API;
        window.supabase = supabase;

        // App state
        const appState = {
            currentPage: null,
            loadedModules: new Set(),
            profile: null
        };

        // Security
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('dragstart', (e) => {
            if (!e.target.closest('[draggable="true"]')) e.preventDefault();
        });

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🔒 SteadyManager Shell initializing...');
            
            if (typeof lucide !== 'undefined') lucide.createIcons();
            
            setupNavigation();
            setupUserMenu();
            setupMobileTitleClick();
            
            await initializeShell();
        });

        async function initializeShell() {
            try {
                if (!API) throw new Error('API failed to load');
                
                const { authenticated } = await API.checkAuth();
                if (!authenticated) {
                    window.location.href = '/auth/login.html';
                    return;
                }
                
                const { data: { session } } = await supabase.auth.getSession();
                if (!session?.user?.email_confirmed_at) {
                    window.location.href = '/auth/resend-verification.html';
                    return;
                }

                const tosCheck = await API.checkTosAcceptance();
if (!tosCheck.accepted) {
    showTosPopup();
    return; // Stop here until ToS accepted
}
                
                const profile = await API.getProfile();
                if (!profile?.id) throw new Error('Invalid profile');
                
                appState.profile = profile;
                loadUserProfile(profile);
                
                console.log('✅ Shell initialized');
                await loadPage('dashboard');
                
            } catch (error) {
                console.error('❌ Shell init failed:', error);
                showError(API.handleAPIError(error, 'Shell'));
            }
        }

        async function loadPage(pageName) {
            // Skip if already on this page
            if (appState.currentPage === pageName) {
                console.log(`Already on ${pageName}`);
                return;
            }
            
            console.log(`Loading: ${pageName}`);
            
            // Update UI
            document.querySelectorAll('.page-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${pageName}-content`)?.classList.add('active');
            
            document.querySelectorAll('.nav-link, .upgrade-nav-link').forEach(l => l.classList.remove('active'));
            if (pageName === 'upgrade') {
                document.querySelector('.upgrade-nav-link')?.classList.add('active');
            } else {
                document.querySelector(`[data-page="${pageName}"]`)?.classList.add('active');
            }
            
            const titles = {
                dashboard: 'Dashboard',
                leads: 'Add Leads',
                pipeline: 'Pipeline',
                tasks: 'Tasks',
                settings: 'Settings',
                upgrade: 'Upgrade Plan'
            };
            document.getElementById('pageTitle').textContent = titles[pageName] || 'Dashboard';
            
            // Update state
            appState.currentPage = pageName;
            
            // Load module
            await loadModule(pageName);
        }

        async function loadModule(pageName) {
            try {
                const modules = {
                    dashboard: window.DashboardModule,
                    leads: window.AddLeadModule,
                    pipeline: window.PipelineModule,
                    tasks: window.SchedulingModule,
                    settings: window.SettingsModule
                };
                
                const module = modules[pageName];
                if (!module?.init) return;
                
                // Always reload to get fresh data
                await module.init(`${pageName}-content`);
                appState.loadedModules.add(pageName);
                console.log(`📦 ${pageName} loaded`);
                
            } catch (error) {
                console.error(`Module load error:`, error);
            }
        }

        function loadUserProfile(profile) {
            const email = profile.email || 'User';
            const initials = generateInitials(email);
            
            const tierNames = {
                'free': 'Free Plan',
                'professional': 'Professional',
                'professional_trial': 'Trial',
                'business': 'Business',
                'enterprise': 'Enterprise',
                'admin': 'Admin'
            };
            
            document.getElementById('userName').textContent = email;
            document.getElementById('userTier').textContent = tierNames[profile.user_type] || 'Free Plan';
            
            const avatar = document.getElementById('userAvatar');
            avatar.innerHTML = '';
            avatar.textContent = initials;
        }

        function generateInitials(email) {
            if (!email) return 'U';
            const name = email.split('@')[0];
            const parts = name.split(/[._-]/);
            if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
            return name.substring(0, 2).toUpperCase();
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('dashboard-theme', newTheme);
            if (window.SteadyUtils?.showToast) {
                SteadyUtils.showToast(`Switched to ${newTheme} mode`, 'success');
            }
        }

        function setupNavigation() {
            document.querySelectorAll('.nav-link, .upgrade-nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    
                    if (window.innerWidth <= 1024) {
                        setTimeout(() => {
                            document.getElementById('sidebar')?.classList.remove('mobile-open');
                        }, 150);
                    }
                    
                    if (page) loadPage(page);
                });
            });
        }

        function setupUserMenu() {
            const menu = document.getElementById('userMenu');
            const dropdown = document.getElementById('profileDropdown');
            
            menu.onclick = (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('show');
            };
            
            document.addEventListener('click', () => dropdown.classList.remove('show'));
            
            document.getElementById('darkModeToggle').onclick = (e) => {
                e.stopPropagation();
                toggleTheme();
            };
            
            dropdown.querySelector('[data-page="settings"]').addEventListener('click', () => {
                loadPage('settings');
                dropdown.classList.remove('show');
            });
            
            document.getElementById('logoutBtn').onclick = async () => {
                if (!confirm('Logout?')) return;
                try {
                    await API.logout();
                } catch (e) {
                    console.error('Logout error:', e);
                }
                window.location.href = '/auth/login.html';
            };
        }

        function setupMobileTitleClick() {
            const title = document.getElementById('pageTitle');
            const sidebar = document.getElementById('sidebar');
            const main = document.querySelector('.main-content');
            
            title.onclick = () => {
                if (window.innerWidth <= 1024) {
                    sidebar.classList.toggle('mobile-open');
                } else {
                    sidebar.classList.toggle('desktop-hidden');
                    main.classList.toggle('sidebar-hidden');
                }
            };
            
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 1024 && 
                    !sidebar.contains(e.target) && 
                    !title.contains(e.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        }

        function showError(msg) {
            const container = document.getElementById('dashboard-content');
            if (!container) return;
            
            container.innerHTML = `
                <div style="text-align: center; padding: 4rem;">
                    <h2>Connection Error</h2>
                    <p style="margin: 1rem 0;">${API.escapeHtml(msg)}</p>
                    <button onclick="location.reload()" style="padding: 0.75rem 1.5rem; background: var(--primary); color: white; border: none; border-radius: var(--radius); cursor: pointer; font-weight: 600;">Retry</button>
                </div>
            `;
        }

        function showTosPopup() {
    const popup = document.createElement('div');
    popup.id = 'tosModal';
    popup.innerHTML = `
        <style>
            #tosModal .tos-modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(8px);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 99999;
                padding: 1rem;
            }
            
            #tosModal .tos-modal {
                background: var(--surface);
                border-radius: 16px;
                max-width: 600px;
                width: 100%;
                max-height: 90vh;
                display: flex;
                flex-direction: column;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                border: 1px solid var(--border);
            }
            
            #tosModal .tos-modal h2 {
                margin: 0;
                padding: 2rem;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 16px 16px 0 0;
                font-size: 1.5rem;
            }
            
            #tosModal .tos-content {
                padding: 2rem;
                overflow-y: auto;
                flex: 1;
            }
            
            #tosModal .tos-scroll-box {
                max-height: 300px;
                overflow-y: auto;
                padding: 1.5rem;
                background: var(--background);
                border: 1px solid var(--border);
                border-radius: 12px;
                margin: 1.5rem 0;
                line-height: 1.6;
                color: var(--text-secondary);
            }
            
            #tosModal .tos-scroll-box::-webkit-scrollbar {
                width: 8px;
            }
            
            #tosModal .tos-scroll-box::-webkit-scrollbar-thumb {
                background: var(--primary);
                border-radius: 4px;
            }
            
            #tosModal .tos-scroll-box h3 {
                color: var(--text-primary);
                margin-top: 1.5rem;
            }
            
            #tosModal .tos-scroll-box h4 {
                color: var(--primary);
                margin-top: 1rem;
            }
            
            #tosModal .tos-checkbox {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                cursor: pointer;
                padding: 1rem;
                background: var(--surface-hover);
                border-radius: 8px;
                border: 2px solid transparent;
                transition: all 0.3s;
            }
            
            #tosModal .tos-checkbox:hover {
                border-color: var(--primary);
            }
            
            #tosModal .tos-checkbox input[type="checkbox"] {
                width: 20px;
                height: 20px;
                cursor: pointer;
            }
            
            #tosModal .tos-checkbox span {
                color: var(--text-primary);
                font-weight: 600;
            }
            
            #tosModal .tos-actions {
                display: flex;
                gap: 1rem;
                padding: 1.5rem 2rem;
                background: var(--surface-hover);
                border-radius: 0 0 16px 16px;
            }
            
            #tosModal .tos-actions button {
                flex: 1;
                padding: 1rem;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s;
            }
            
            #tosModal .btn-decline {
                background: var(--surface);
                color: var(--text-secondary);
                border: 1px solid var(--border);
            }
            
            #tosModal .btn-decline:hover {
                background: var(--danger);
                color: white;
                border-color: var(--danger);
            }
            
            #tosModal .btn-accept {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
            
            #tosModal .btn-accept:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }
            
            #tosModal .btn-accept:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
        </style>
        
        <div class="tos-modal-overlay">
            <div class="tos-modal">
                <h2>📋 Terms of Service</h2>
                <div class="tos-content">
                    <p>Welcome to <strong>SteadyManager</strong>! Before you continue, please review and accept our Terms of Service.</p>
                    
                    <div class="tos-scroll-box">
                        <h3>Terms of Service Agreement</h3>
                        <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
                        
                        <h4>1. Acceptance of Terms</h4>
                        <p>By accessing and using SteadyManager, you agree to be bound by these Terms of Service and our Privacy Policy.</p>
                        
                        <h4>2. Use of Service</h4>
                        <p>You agree to use SteadyManager for lawful purposes only. You will not use our service to store, transmit, or distribute any content that violates laws or infringes on rights of others.</p>
                        
                        <h4>3. Account Responsibilities</h4>
                        <p>You are responsible for maintaining the confidentiality of your account credentials and for all activities under your account.</p>
                        
                        <h4>4. Data and Privacy</h4>
                        <p>We collect and process your data as described in our Privacy Policy. We take security seriously and implement industry-standard measures to protect your information.</p>
                        
                        <h4>5. Service Availability</h4>
                        <p>We strive to maintain high availability but do not guarantee uninterrupted access. Scheduled maintenance and updates may temporarily affect service.</p>
                        
                        <h4>6. Modifications</h4>
                        <p>We reserve the right to modify these terms. Continued use after changes constitutes acceptance of modified terms.</p>
                        
                        <h4>7. Termination</h4>
                        <p>We may terminate or suspend access to our service immediately, without prior notice, for conduct that violates these terms.</p>
                        <h4>Welcome to SteadyManager</h4>
<p>Hey! Thanks for checking out SteadyManager. We built this to help independent sales professionals manage their leads and tasks without the spreadsheet headaches. Before you dive in, please read these Terms of Service - they're important (and required by law).</p>

<p style="margin-bottom: 2rem; color: var(--text-secondary); font-style: italic;">
    TL;DR: Use SteadyManager for good, don't be a jerk, and we'll provide you a solid CRM tool. We respect your data and privacy.
</p>

<h4>1. Acceptance of Terms</h4>
<p>By creating an account, accessing, or using SteadyManager (the "Service"), you ("User", "you", or "your") enter into a legally binding agreement with Steady Scaling LLC ("we", "us", or "our"). These Terms of Service ("Terms") govern your access to and use of our web-based customer relationship management platform.</p>

<p>By clicking "I Accept", creating an account, or using any part of our Service, you acknowledge that you have read, understood, and agree to be bound by these Terms and our Privacy Policy. If you don't agree, please don't use the Service.</p>

<p>You must be at least 18 years old to use SteadyManager. If you're using the Service on behalf of a business or organization, you represent that you have the authority to bind that entity to these Terms.</p>

<h4>2. Use of Service</h4>
<p><strong>What SteadyManager Does:</strong> We provide a cloud-based CRM platform designed specifically for individual sales professionals to manage leads, track pipelines, schedule tasks, and stay organized. Think of it as your personal sales command center.</p>

<p><strong>How You Can Use It:</strong> You may use SteadyManager for lawful business purposes - managing your sales leads, tracking customer relationships, scheduling follow-ups, and organizing your sales activities.</p>

<p><strong>What You Can't Do:</strong> Please don't:</p>
<ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
    <li>Use the Service to spam people or send unsolicited emails</li>
    <li>Upload malware, viruses, or anything that could harm the Service</li>
    <li>Try to hack, reverse engineer, or break into the Service</li>
    <li>Share your account with others (it's single-user only)</li>
    <li>Resell or redistribute the Service without permission</li>
    <li>Store illegal content or violate anyone's privacy</li>
    <li>Use bots or scrapers to access the Service</li>
    <li>Overload our servers or abuse the system</li>
    <li>Remove our copyright notices or branding</li>
    <li>Impersonate other people or misrepresent yourself</li>
</ul>

<p><strong>Your Responsibility:</strong> You're responsible for complying with all laws that apply to your business, including data protection regulations (like GDPR or CCPA), anti-spam laws (like CAN-SPAM), and any industry-specific rules. If you send emails through integrated services, make sure you have permission from recipients and include proper unsubscribe options.</p>

<h4>3. Account Registration and Security</h4>
<p><strong>Creating Your Account:</strong> You'll need to provide accurate information when signing up. Keep your profile updated - it helps us serve you better and is required by law.</p>

<p><strong>Account Security:</strong> Your account is single-user only. You're responsible for:</p>
<ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
    <li>Choosing a strong, unique password</li>
    <li>Keeping your login credentials private (don't share your account)</li>
    <li>Notifying us immediately if someone unauthorized accesses your account</li>
    <li>All activity that happens under your account</li>
</ul>

<p><strong>Email Verification:</strong> You must verify your email address to use the Service. If you don't verify within a reasonable time, we may suspend your account.</p>

<p><strong>Single-User Accounts:</strong> Each account is for one person only. If you need multiple users, each person needs their own separate account. We don't offer team or multi-user plans at this time.</p>

<h4>4. Service Plans, Pricing, and Payment</h4>
<p><strong>Service Tiers:</strong> We offer different plans to fit your needs:</p>
<ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
    <li><strong>Free Tier:</strong> 50 leads, basic CRM features - perfect for getting started</li>
    <li><strong>Professional Tier:</strong> More leads and advanced analytics</li>
    <li><strong>Higher Tiers:</strong> Additional capacity and features as described on our pricing page</li>
</ul>

<p><strong>Free Trial:</strong> New free users can try Professional features for 14 days, one time only. After the trial ends, you'll return to Free Tier unless you subscribe. We reserve the right to limit trial eligibility to prevent abuse.</p>

<p><strong>Pricing:</strong> Current pricing is at steadymanager.com/pricing. We can change prices anytime, but changes won't affect your current billing cycle. We'll give you at least 30 days' notice before any price changes.</p>

<p><strong>Payment:</strong> We use Stripe to process payments securely. We never see or store your credit card information - Stripe handles everything. By subscribing, you authorize us to charge your payment method for all applicable fees.</p>

<p><strong>Billing:</strong> Subscriptions are billed monthly or annually depending on your choice. They automatically renew unless you cancel before the renewal date. You're responsible for all charges, including any taxes.</p>

<p><strong>Refunds:</strong> All payments are non-refundable. However, we may offer refunds on a case-by-case basis at our sole discretion. Contact us at josh@steadyscaling.com if you believe you deserve a refund - we'll consider it, but can't guarantee anything.</p>

<p><strong>Failed Payments:</strong> If your payment fails, we'll try charging again. If we still can't collect payment, we may downgrade or suspend your account. Keep your payment info current!</p>

<p><strong>Taxes:</strong> Our prices don't include taxes. You're responsible for paying any applicable sales tax, VAT, or other taxes.</p>

<h4>5. Your Data, Privacy, and Security</h4>
<p><strong>You Own Your Data:</strong> All the leads, notes, tasks, and other content you create in SteadyManager belongs to YOU. We claim zero ownership over your data.</p>

<p><strong>What We Can Do With Your Data:</strong> You give us permission to store, process, and display your data solely to provide the Service. This permission ends when you delete your data or close your account (except where required by law).</p>

<p><strong>How We Collect Data:</strong> We collect what you give us (account info, lead data, tasks) and some usage data to improve the Service. Read our Privacy Policy for full details on what we collect and why.</p>

<p><strong>Security:</strong> We take security seriously. Your data is:</p>
<ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
    <li>Encrypted in transit (HTTPS) and at rest</li>
    <li>Hosted on secure AWS infrastructure via Supabase</li>
    <li>Protected by industry-standard security measures</li>
    <li>Monitored for suspicious activity</li>
</ul>

<p>That said, no system is 100% secure. We can't guarantee absolute security, but we work hard to protect your data.</p>

<p><strong>Data Breaches:</strong> If we discover a breach affecting your data, we'll notify you as required by law and take steps to fix it.</p>

<p><strong>Data Retention:</strong> We keep your data while your account is active. If you close your account, we'll delete your data within 90 days (unless legally required to keep it for things like fraud prevention). You can request data deletion anytime by contacting support.</p>

<p><strong>Export Your Data:</strong> You can export all your data as a CSV file anytime from your account settings. Your data is portable - take it with you if you leave.</p>

<p><strong>Payment Data:</strong> We don't store your credit card information. Stripe handles all payment processing and storage securely.</p>

<p><strong>Third-Party Services:</strong> SteadyManager may integrate with other services (like email or calendar apps). Those services have their own terms and privacy policies - we're not responsible for them.</p>

<h4>6. California Privacy Rights (CCPA)</h4>
<p>If you're a California resident, you have additional rights under the California Consumer Privacy Act:</p>

<p><strong>Right to Know:</strong> You can request details about what personal information we've collected about you in the past 12 months.</p>

<p><strong>Right to Delete:</strong> You can request deletion of your personal information (with some exceptions required by law).</p>

<p><strong>Right to Opt-Out:</strong> We don't sell your personal information to third parties, so there's nothing to opt out of. We never have and never will sell your data.</p>

<p><strong>Right to Non-Discrimination:</strong> We won't discriminate against you for exercising your privacy rights.</p>

<p><strong>How to Exercise Rights:</strong> Email us at josh@steadyscaling.com with your request. We'll respond within 45 days.</p>

<h4>7. Service Availability and Support</h4>
<p><strong>Uptime:</strong> We work hard to keep SteadyManager running smoothly and aim for 99.9% uptime. However, stuff happens - maintenance, technical issues, internet problems. We don't guarantee the Service will always be available.</p>

<p><strong>Maintenance:</strong> We may need to take the Service down occasionally for updates or fixes. We'll try to give you a heads up when possible.</p>

<p><strong>Changes to Service:</strong> We can modify, add, or remove features anytime. We're constantly improving things based on feedback.</p>

<p><strong>Support:</strong> Email us at josh@steadyscaling.com for help. We'll do our best to respond within 48 hours during business days. Please be patient - we're a small team!</p>

<p><strong>Usage Limits:</strong> Your plan has limits (like number of leads). If you exceed them, we may ask you to upgrade or temporarily suspend access until you upgrade.</p>

<h4>8. Intellectual Property</h4>
<p><strong>We Own SteadyManager:</strong> The Service itself - all the code, design, features, logos, and branding - belongs to Steady Scaling LLC. It's protected by copyright and trademark laws.</p>

<p><strong>Your License:</strong> We give you permission to use SteadyManager for your personal business use. You can't resell it, redistribute it, or use it to provide services to others without our permission.</p>

<p><strong>Our Trademarks:</strong> "SteadyManager" and our logo are trademarks. Don't use them without permission.</p>

<p><strong>Your Feedback:</strong> If you send us ideas, suggestions, or feedback about improving the Service, we can use them freely without owing you anything. (But we'll definitely appreciate it!)</p>

<h4>9. Termination and Cancellation</h4>
<p><strong>You Can Leave Anytime:</strong> Delete your account through settings or email josh@steadyscaling.com. Your data will be deleted per our retention policy.</p>

<p><strong>Canceling Paid Plans:</strong> Cancel anytime through your account settings. You'll keep access until the end of your current billing period, but no refunds for unused time.</p>

<p><strong>We Can Terminate Too:</strong> We can suspend or terminate accounts for reasons like:</p>
<ul style="margin-left: 1.5rem; margin-bottom: 1rem; color: var(--text-secondary);">
    <li>Violating these Terms</li>
    <li>Illegal activity or fraud</li>
    <li>Non-payment</li>
    <li>Abuse of the Service</li>
    <li>Extended inactivity</li>
    <li>Legal requirements</li>
</ul>

<p><strong>What Happens After:</strong> When your account is terminated, you lose access immediately. Your data is deleted within 90 days. We're not liable for any losses from termination.</p>

<h4>10. Disclaimers and Liability Limits</h4>
<p><strong>No Warranties:</strong> THE SERVICE IS PROVIDED "AS IS" WITHOUT ANY WARRANTIES. We don't guarantee it'll be perfect, error-free, or always available. Use it at your own risk.</p>

<p><strong>Limited Liability:</strong> TO THE MAXIMUM EXTENT ALLOWED BY LAW, WE'RE NOT LIABLE FOR ANY INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING FROM YOUR USE OF THE SERVICE. THIS INCLUDES LOST PROFITS, LOST DATA, OR BUSINESS INTERRUPTION.</p>

<p>OUR TOTAL LIABILITY TO YOU FOR ANYTHING RELATED TO THE SERVICE CAN'T EXCEED THE GREATER OF: (A) WHAT YOU PAID US IN THE PAST 12 MONTHS, OR (B) $100.</p>

<p><strong>Translation:</strong> We built this tool to help you, but we're not responsible if something goes wrong. Always keep backups of important data.</p>

<h4>11. You Indemnify Us</h4>
<p>If someone sues us because of something you did (like uploading illegal content, spamming people, or violating someone's rights), you agree to cover our legal costs and any damages. Basically: don't get us sued.</p>

<h4>12. Disputes and Governing Law</h4>
<p><strong>Minnesota Law Applies:</strong> These Terms are governed by Minnesota state law, where we're based.</p>

<p><strong>Try to Work It Out First:</strong> If we have a dispute, email josh@steadyscaling.com first. Let's try to resolve it like adults before involving lawyers.</p>

<p><strong>Courts:</strong> If we can't work it out informally within 60 days, any legal action must be filed in the state or federal courts in Hennepin County, Minnesota. You agree to that jurisdiction.</p>

<p><strong>No Class Actions:</strong> You agree to resolve disputes individually, not as part of a class action lawsuit.</p>

<h4>13. Changes to These Terms</h4>
<p>We can update these Terms anytime. If we make major changes, we'll email you at least 30 days before they take effect. Continuing to use SteadyManager after changes means you accept them.</p>

<p>If you don't like the new Terms, you can close your account. We encourage you to check these Terms occasionally.</p>

<h4>14. Miscellaneous Legal Stuff</h4>
<p><strong>Entire Agreement:</strong> These Terms plus our Privacy Policy are the complete agreement between us.</p>

<p><strong>Severability:</strong> If one part of these Terms is found invalid, the rest still applies.</p>

<p><strong>No Waiver:</strong> If we don't enforce something once, that doesn't mean we can't enforce it later.</p>

<p><strong>No Assignment:</strong> You can't transfer these Terms to someone else without our permission. We can transfer them freely.</p>

<p><strong>Force Majeure:</strong> We're not liable for delays caused by things outside our control (natural disasters, pandemics, wars, internet outages, zombie apocalypse, etc.).</p>

<p><strong>Independent Contractors:</strong> These Terms don't create any partnership, employment, or agency relationship between us.</p>

<h4>15. Contact Us</h4>
<p>Questions? Concerns? Just want to chat? Reach out!</p>

<p style="margin: 1.5rem 0; padding: 1.5rem; background: var(--background); border-radius: var(--radius); border: 1px solid var(--border);">
    <strong style="color: var(--text-primary);">Steady Scaling LLC</strong><br>
    <strong style="color: var(--text-secondary);">Email:</strong> <a href="mailto:josh@steadyscaling.com" style="color: var(--primary);">josh@steadyscaling.com</a><br>
    <strong style="color: var(--text-secondary);">Address:</strong> 15797 Porchlight Ln, Eden Prairie, MN 55347<br>
    <strong style="color: var(--text-secondary);">Data Protection Officer:</strong> <a href="mailto:josh@steadyscaling.com" style="color: var(--primary);">josh@steadyscaling.com</a>
</p>

<p style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border); font-size: 0.9rem; color: var(--text-secondary);">
    <strong>Last Updated:</strong> January 20, 2025<br>
    <strong>Version:</strong> 1.0<br>
    <strong>Effective Date:</strong> January 20, 2025
</p>

<p style="margin-top: 1.5rem; font-size: 0.85rem; color: var(--text-tertiary); font-style: italic;">
    Built with ❤️ by an indie developer who believes sales pros deserve better tools than spreadsheets.
</p>
                        <p style="margin-top: 2rem; font-size: 0.9rem; opacity: 0.7;">For complete terms, visit our <a href="/pages/terms.html" target="_blank" style="color: #667eea;">Terms of Service</a> page.</p>
                    </div>
                    
                    <label class="tos-checkbox">
                        <input type="checkbox" id="tosAcceptCheckbox">
                        <span>I have read and agree to the Terms of Service and Privacy Policy</span>
                    </label>
                </div>
                
                <div class="tos-actions">
                    <button class="btn-decline" id="tosDeclineBtn">Decline & Logout</button>
                    <button class="btn-accept" id="tosAcceptBtn" disabled>Accept & Continue</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(popup);

    const declineBtn = document.getElementById('tosDeclineBtn');
        declineBtn.onclick = () => {
            if (confirm('Are you sure? You must accept the Terms to use SteadyManager.')) {
                API.logout().catch(() => {
                    window.location.href = '/auth/login.html';
                });
            }
        };
    const checkbox = document.getElementById('tosAcceptCheckbox');
    const acceptBtn = document.getElementById('tosAcceptBtn');
    
    checkbox.onchange = () => {
        acceptBtn.disabled = !checkbox.checked;
    };
    
    acceptBtn.onclick = async () => {
        acceptBtn.disabled = true;
        acceptBtn.textContent = 'Accepting...';
        
        try {
            await API.acceptTos('1.0');
            popup.remove();
            location.reload();
        } catch (error) {
            console.error('ToS acceptance error:', error);
            alert('Failed to accept Terms. Please try again.');
            acceptBtn.disabled = false;
            acceptBtn.textContent = 'Accept & Continue';
        }
    };
}

function handleTosDecline() {
    if (confirm('Are you sure? You must accept the Terms to use SteadyManager.')) {
        API.logout();
    }
}

        window.loadPage = loadPage;
    </script>

    <script src="/dashboard/shared/js/utils.js"></script>
    <script src="/dashboard/tiers/free/scripts/dashboard.js"></script>
    <script src="/dashboard/tiers/free/scripts/AddLead.js"></script>
    <script src="/dashboard/tiers/free/scripts/Pipeline.js"></script>
    <script src="/dashboard/tiers/free/scripts/Scheduling.js"></script>
    <script src="/dashboard/tiers/free/scripts/Settings.js"></script>
    <script src="/dashboard/tiers/free/scripts/upgrade.js"></script>
</body>
</html>